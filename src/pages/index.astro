---
import { format } from "date-fns";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import Layout from "../layouts/Layout.astro";
const pageDescription = "Milton David's personal website";

function formatDate(date: string) {
  const datePattern = "MMM dd yyyy";

  return format(new Date(date), datePattern);
}

const articles = await getCollection("articles");

const orderedArticles = articles.sort((prev, next) => {
  const prevTime = new Date(prev.data.updatedAt).getTime();
  const nextTime = new Date(next.data.updatedAt).getTime();
  if (prevTime < nextTime) return 1;
  else if (prevTime > nextTime) return -1;

  return 0;
});

const drafts = orderedArticles.filter((article) => article.data.isDraft);

const projects: Array<{
  name: string;
  description: string;
  link: string;
}> = [
  {
    name: "minhamola",
    link: "https://minhamola.com",
    description:
      "A web-based personal finance management application. Built with Vue.js and Express.js.",
  },
  {
    name: "typed-formdata",
    link: "https://github.com/ToniMaunde/typed-formdata",
    description:
      "An experiment on parsing and validating the native formdata object based on a schema. Built with TypeScript and Zod.",
  },
  {
    name: "react-svg-icon",
    link: "https://github.com/ToniMaunde/react-svg-component",
    description:
      "A tree-shakeable approach to rendering SVGs (in React.js). All without the use of a library or using the HTMLImageElement. Built with React.js and TypeScript.",
  },
];
---

<Layout
  title="Home - Milton David"
  description={pageDescription}
  isArticle={false}
>
  <main class="px-6 flex flex-col gap-12">
    <header>
      <h1 class="font-lora-bold text-supporting-600 text-[2rem]/10 mb-2">
        Building tools that I need
      </h1>
      <p class="text-supporting-500 text-lg/6 mb-6">
        expecting to benefit others as well.
      </p>
      <p class="text-supporting-300 leading-[150%]">
        Iâ€™m a Software Engineer and an UI Designer. I combine these skills to
        create digital solutions to solve everyday problems. I use neovim btw.
      </p>
    </header>
    <section class="flex flex-col">
      <h2 class="font-lora-bold text-lg/6 text-supporting-600 mb-4">
        Projects
      </h2>
      <ul class="projects flex flex-col gap-6">
        {
          projects.map((project) => (
            <li>
              <a
                class="flex items-center gap-1 mb-2 w-fit"
                href={project.link}
                target="_blank"
                rel="noreferrer"
              >
                <h3 class="font-inter-medium text-lg/6 text-supporting-400 hover:underline">
                  {project.name}
                </h3>
                <Icon name="new_window" />
              </a>
              <p class="text-supporting-300">{project.description}</p>
            </li>
          ))
        }
      </ul>
    </section>
    <section class="flex flex-col gap-4">
      <h2 class="font-lora-bold text-lg/6 text-supporting-600">Articles</h2>
      <ul class="flex flex-col gap-6">
        {
          orderedArticles.map((article) => (
            <li class="flex flex-col gap-2">
              <a
                href={`/articles/${article.slug}`}
                class="h-full flex flex-col w-fit"
              >
                <h3 class="font-inter-medium text-lg/6 text-supporting-400 hover:underline">
                  {article.data.title}
                </h3>
              </a>
              <p class="text-supporting-300">{article.data.description}</p>
              <p class="text-sm/4 text-supporting-200">
                {formatDate(article.data.updatedAt)}
              </p>
            </li>
          ))
        }
      </ul>
    </section>
    <section class="flex flex-col gap-4 mb-8">
      <h2 class="font-lora-bold text-lg/6 text-supporting-600">Drafts</h2>
      {
        drafts.length > 0 ? (
          <ul class="flex flex-col gap-6">
            {drafts.map((article) => (
              <li class="flex flex-col gap-2 w-fit">
                <a
                  href={`/articles/${article.slug}`}
                  class="h-full flex flex-col"
                >
                  <h3 class="font-inter-medium text-lg/6 text-supporting-400 hover:underline">
                    {article.data.title}
                  </h3>
                </a>
                <p class="text-supporting-300">{article.data.description}</p>
                <p class="text-sm/4 text-supporting-200">
                  {formatDate(article.data.updatedAt)}
                </p>
              </li>
            ))}
          </ul>
        ) : (
          <p class="text-supporting-300">Oh no, I'm not writing enough.</p>
        )
      }
    </section>
  </main>
</Layout>
